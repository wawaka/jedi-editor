<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JEDI - JSON Schema Editor</title>

  <script type="importmap">
  {
    "imports": {
      "lit": "./vendor/lit.js",
      "ajv": "./vendor/ajv.js",
      "ajv-formats": "./vendor/ajv-formats.js"
    }
  }
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0a0e27;
      color: #ffffff;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 1rem;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: #0f1629;
      border-radius: 0.5rem 0.5rem 0 0;
      border: 1px solid #1e2a4a;
      border-bottom: none;
    }

    header h1 {
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    header h1 .badge {
      font-size: 0.625rem;
      font-weight: 500;
      padding: 0.125rem 0.5rem;
      background: rgba(77, 166, 255, 0.2);
      color: #4da6ff;
      border-radius: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    header p {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .controls button {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .controls button.primary {
      background: #1d4ed8;
      color: white;
    }

    .controls button.primary:hover {
      background: #2563eb;
    }

    .controls button.secondary {
      background: #1e2a4a;
      color: #9ca3af;
    }

    .controls button.secondary:hover {
      background: #2d3a5a;
      color: white;
    }

    .controls button.danger {
      background: transparent;
      color: #ff4444;
      border: 1px solid rgba(255, 68, 68, 0.3);
    }

    .controls button.danger:hover {
      background: rgba(255, 68, 68, 0.1);
    }

    .controls .divider {
      width: 1px;
      height: 1.25rem;
      background: #1e2a4a;
    }

    .controls .status {
      font-size: 0.75rem;
      color: #9ca3af;
      padding: 0 0.5rem;
    }

    .controls .status.saved {
      color: #00ff88;
    }

    .editor-wrapper {
      flex: 1;
      min-height: 0;
      border: 1px solid #1e2a4a;
      border-radius: 0 0 0.5rem 0.5rem;
      overflow: hidden;
    }

    je-editor {
      height: 100%;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #9ca3af;
      font-size: 0.875rem;
    }

    .loading::after {
      content: '';
      width: 1.5rem;
      height: 1.5rem;
      margin-left: 0.75rem;
      border: 2px solid #1e2a4a;
      border-top-color: #4da6ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>
          JEDI
          <span class="badge">JSON Schema Editor</span>
        </h1>
        <p>Visual JSON editing with schema validation</p>
      </div>
      <div class="controls">
        <span id="status" class="status"></span>
        <div class="divider"></div>
        <button id="btn-grid" class="secondary" title="Toggle debug grid">Grid</button>
        <button id="btn-reset" class="secondary" title="Reset to example data">Reset</button>
      </div>
    </header>

    <div class="editor-wrapper">
      <div id="loading" class="loading">Loading editor components</div>
      <je-editor id="editor" style="display: none;"></je-editor>
    </div>
  </div>

  <script type="module">
    // Import the main editor component
    import './src/index.js';

    // ═══════════════════════════════════════════════════════════════
    // Elaborate Example Schema and Data
    // ═══════════════════════════════════════════════════════════════

    const EXAMPLE_SCHEMA = {
      type: 'object',
      properties: {
        id: { type: 'integer' },
        name: { type: 'string' },
        email: { type: 'string' },
        age: { type: 'integer' },
        isActive: { type: 'boolean' },
        role: {
          type: 'string',
          enum: ['admin', 'user', 'guest']
        },
        address: {
          type: 'object',
          properties: {
            street: { type: 'string' },
            city: { type: 'string' },
            zipCode: { type: 'string' },
            country: { type: 'string' }
          }
        },
        tags: {
          type: 'array',
          items: { type: 'string' }
        },
        settings: {
          type: 'object',
          properties: {
            theme: { type: 'string', enum: ['light', 'dark', 'auto'] },
            notifications: { type: 'boolean' },
            language: { type: 'string' }
          }
        }
      },
      required: ['id', 'name', 'email']
    };

    const EXAMPLE_DATA = {
      id: 1,
      name: 'John Doe',
      email: 'john@example.com',
      age: 32,
      isActive: true,
      role: 'admin',
      address: {
        street: '123 Main St',
        city: 'New York',
        zipCode: '10001',
        country: 'USA'
      },
      tags: ['developer', 'designer', 'manager'],
      settings: {
        theme: 'dark',
        notifications: true,
        language: 'en'
      }
    };

    // Storage keys for demo persistence
    const STORAGE_KEY_SCHEMA = 'json-editor-demo-schema';
    const STORAGE_KEY_DATA = 'json-editor-demo-data';

    // ═══════════════════════════════════════════════════════════════
    // Initialize Editor
    // ═══════════════════════════════════════════════════════════════

    const editor = document.getElementById('editor');
    const statusEl = document.getElementById('status');

    // Check for saved data in localStorage
    function loadFromStorage() {
      try {
        const savedSchema = localStorage.getItem(STORAGE_KEY_SCHEMA);
        const savedData = localStorage.getItem(STORAGE_KEY_DATA);
        if (savedSchema && savedData) {
          return {
            schema: JSON.parse(savedSchema),
            data: JSON.parse(savedData)
          };
        }
      } catch (e) {
        console.error('Failed to load from localStorage:', e);
      }
      return null;
    }

    function saveToStorage(schema, data) {
      try {
        localStorage.setItem(STORAGE_KEY_SCHEMA, JSON.stringify(schema));
        localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(data));
        updateStatus(true);
      } catch (e) {
        console.error('Failed to save to localStorage:', e);
      }
    }

    function clearStorage() {
      localStorage.removeItem(STORAGE_KEY_SCHEMA);
      localStorage.removeItem(STORAGE_KEY_DATA);
      updateStatus(false);
    }

    function hasSaved() {
      return localStorage.getItem(STORAGE_KEY_SCHEMA) !== null;
    }

    function updateStatus(saved) {
      if (saved || hasSaved()) {
        statusEl.textContent = 'Auto-saved';
        statusEl.className = 'status saved';
      } else {
        statusEl.textContent = '';
        statusEl.className = 'status';
      }
    }

    // Wait for component to be defined and ready
    customElements.whenDefined('je-editor').then(async () => {
      // Wait for first render cycle to complete
      await editor.updateComplete;

      // Load saved data or use example
      const saved = loadFromStorage();
      if (saved) {
        editor.setState(saved.schema, saved.data);
      } else {
        editor.setState(EXAMPLE_SCHEMA, EXAMPLE_DATA);
      }

      // Show editor
      document.getElementById('loading').style.display = 'none';
      document.getElementById('editor').style.display = '';

      updateStatus(hasSaved());
    });

    // ═══════════════════════════════════════════════════════════════
    // Auto-save on changes
    // ═══════════════════════════════════════════════════════════════

    editor.addEventListener('schema-change', (e) => {
      saveToStorage(e.detail.schema, editor.data);
    });

    editor.addEventListener('data-change', (e) => {
      saveToStorage(editor.schema, e.detail.data);
    });

    editor.addEventListener('validation-change', (e) => {
      console.log('Validation:', e.detail.isValid ? 'Valid' : 'Invalid', e.detail.errors);
    });

    // ═══════════════════════════════════════════════════════════════
    // Button Handlers
    // ═══════════════════════════════════════════════════════════════

    document.getElementById('btn-reset').addEventListener('click', () => {
      if (confirm('Reset to example data?')) {
        editor.setState(EXAMPLE_SCHEMA, EXAMPLE_DATA);
      }
    });

    document.getElementById('btn-grid').addEventListener('click', () => {
      editor.debugGrid = !editor.debugGrid;
      document.getElementById('btn-grid').classList.toggle('primary', editor.debugGrid);
      document.getElementById('btn-grid').classList.toggle('secondary', !editor.debugGrid);
    });

    // ═══════════════════════════════════════════════════════════════
    // Public API Examples (for console testing)
    // ═══════════════════════════════════════════════════════════════

    // Expose editor to window for console testing
    window.editor = editor;

    console.log('%c JEDI Editor API ', 'background: #1d4ed8; color: white; padding: 4px 8px; border-radius: 4px;');
    console.log('Available commands:');
    console.log('  editor.schema        - Get current schema');
    console.log('  editor.data          - Get current data');
    console.log('  editor.isValid       - Check if data is valid');
    console.log('  editor.errors        - Get validation errors');
    console.log('  editor.getState()    - Get { schema, data, isValid, errors }');
    console.log('  editor.setState(schema, data) - Set both at once');
    console.log('  editor.validate()    - Re-validate and get result');
    console.log('  editor.debugGrid     - Toggle debug grid overlay');
  </script>
</body>
</html>
